<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Verificaci√≥n de Configuraci√≥n - Lo Quiero YA CM</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #FFE5EC 0%, #FFD4B8 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    }

    h1 {
      color: #E57A9D;
      margin-bottom: 10px;
      text-align: center;
    }

    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 30px;
      font-style: italic;
    }

    .check-item {
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      gap: 15px;
      border: 2px solid #FFD1DC;
      transition: all 0.3s ease;
    }

    .check-item.pending {
      background-color: #FFF9C4;
      border-color: #FFE082;
    }

    .check-item.success {
      background-color: #C8E6C9;
      border-color: #81C784;
    }

    .check-item.error {
      background-color: #FFCDD2;
      border-color: #EF5350;
    }

    .icon {
      font-size: 24px;
      min-width: 30px;
      text-align: center;
    }

    .check-content {
      flex-grow: 1;
    }

    .check-title {
      font-weight: 600;
      margin-bottom: 5px;
      color: #333;
    }

    .check-detail {
      font-size: 14px;
      color: #666;
    }

    .btn {
      background: linear-gradient(135deg, #FFB5C2, #E57A9D);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      margin-top: 20px;
      transition: transform 0.2s ease;
    }

    .btn:hover {
      transform: translateY(-2px);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .summary {
      text-align: center;
      padding: 20px;
      margin-top: 20px;
      border-radius: 10px;
      background-color: #F5F5F5;
    }

    .summary.success {
      background-color: #C8E6C9;
    }

    .summary.error {
      background-color: #FFCDD2;
    }

    .code-block {
      background-color: #2D2D2D;
      color: #F8F8F2;
      padding: 15px;
      border-radius: 8px;
      margin: 10px 0;
      overflow-x: auto;
      font-family: 'Courier New', monospace;
      font-size: 13px;
    }

    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #E57A9D;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .help-section {
      margin-top: 30px;
      padding: 20px;
      background-color: #FFF9E6;
      border-radius: 10px;
      border-left: 4px solid #FFC107;
    }

    .help-title {
      font-weight: 600;
      color: #F57F17;
      margin-bottom: 10px;
    }
  </style>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
</head>
<body>
  <div class="container">
    <h1>üî• Verificaci√≥n de Configuraci√≥n</h1>
    <p class="subtitle">Lo Quiero YA CM - #Ant√≥jateDeFelicidad</p>

    <div id="checks-container">
      <!-- Los checks se generan din√°micamente -->
    </div>

    <button class="btn" id="btn-verificar" onclick="verificarTodo()">
      üîç Verificar Configuraci√≥n
    </button>

    <div id="summary" class="summary" style="display: none;">
      <h3 id="summary-title"></h3>
      <p id="summary-text"></p>
    </div>

    <div class="help-section">
      <div class="help-title">üí° ¬øEncontraste errores?</div>
      <p style="margin-bottom: 10px;">Consulta la gu√≠a completa de configuraci√≥n:</p>
      <div class="code-block">
        Ver archivo: GUIA_CONFIGURACION_FIREBASE.md
      </div>
    </div>
  </div>

  <script src="firebase-config.js"></script>
  <script>
    const checks = [
      {
        id: 'firebase-config',
        title: 'Archivo firebase-config.js',
        detail: 'Verificando que el archivo exista y tenga configuraci√≥n v√°lida'
      },
      {
        id: 'firebase-init',
        title: 'Inicializaci√≥n de Firebase',
        detail: 'Conectando con Firebase...'
      },
      {
        id: 'firestore',
        title: 'Firestore Database',
        detail: 'Verificando acceso a la base de datos'
      },
      {
        id: 'auth',
        title: 'Firebase Authentication',
        detail: 'Verificando servicio de autenticaci√≥n'
      },
      {
        id: 'files',
        title: 'Archivos del Proyecto',
        detail: 'Verificando estructura de archivos'
      }
    ];

    let results = {};

    function createCheckElement(check) {
      return `
        <div class="check-item pending" id="check-${check.id}">
          <div class="icon">
            <span class="loading"></span>
          </div>
          <div class="check-content">
            <div class="check-title">${check.title}</div>
            <div class="check-detail" id="detail-${check.id}">${check.detail}</div>
          </div>
        </div>
      `;
    }

    function updateCheck(id, status, detail, icon) {
      const checkEl = document.getElementById(`check-${id}`);
      const detailEl = document.getElementById(`detail-${id}`);
      
      checkEl.className = `check-item ${status}`;
      checkEl.querySelector('.icon').innerHTML = icon;
      detailEl.textContent = detail;
      
      results[id] = status === 'success';
    }

    function renderChecks() {
      const container = document.getElementById('checks-container');
      container.innerHTML = checks.map(check => createCheckElement(check)).join('');
    }

    async function verificarTodo() {
      renderChecks();
      document.getElementById('btn-verificar').disabled = true;
      document.getElementById('summary').style.display = 'none';
      results = {};

      // Peque√±o delay para que se vea la animaci√≥n
      await new Promise(resolve => setTimeout(resolve, 500));

      await verificarFirebaseConfig();
      await verificarFirebaseInit();
      await verificarFirestore();
      await verificarAuth();
      await verificarArchivos();

      mostrarResumen();
      document.getElementById('btn-verificar').disabled = false;
    }

    async function verificarFirebaseConfig() {
      try {
        if (typeof firebaseConfig === 'undefined') {
          updateCheck('firebase-config', 'error', 
            'Archivo no encontrado o sin configuraci√≥n',
            '‚ùå');
          return;
        }

        const required = ['apiKey', 'authDomain', 'projectId'];
        const missing = required.filter(key => !firebaseConfig[key] || firebaseConfig[key].includes('YOUR'));

        if (missing.length > 0) {
          updateCheck('firebase-config', 'error', 
            `Faltan configurar: ${missing.join(', ')}`,
            '‚ö†Ô∏è');
        } else {
          updateCheck('firebase-config', 'success', 
            `Proyecto: ${firebaseConfig.projectId}`,
            '‚úÖ');
        }
      } catch (error) {
        updateCheck('firebase-config', 'error', 
          'Error al leer configuraci√≥n: ' + error.message,
          '‚ùå');
      }
    }

    async function verificarFirebaseInit() {
      try {
        if (typeof firebase === 'undefined') {
          updateCheck('firebase-init', 'error', 
            'Firebase SDK no cargado. Verifica tu conexi√≥n a Internet',
            '‚ùå');
          return;
        }

        if (!firebase.apps.length) {
          firebase.initializeApp(firebaseConfig);
        }

        updateCheck('firebase-init', 'success', 
          'Firebase inicializado correctamente',
          '‚úÖ');
      } catch (error) {
        updateCheck('firebase-init', 'error', 
          'Error inicializando: ' + error.message,
          '‚ùå');
      }
    }

    async function verificarFirestore() {
      try {
        const db = firebase.firestore();
        
        // Intentar leer una colecci√≥n
        const testQuery = await db.collection('pedidos').limit(1).get();
        
        updateCheck('firestore', 'success', 
          `Firestore conectado. ${testQuery.size} documento(s) encontrado(s)`,
          '‚úÖ');
      } catch (error) {
        if (error.code === 'permission-denied') {
          updateCheck('firestore', 'error', 
            'Error de permisos. Despliega las reglas: firebase deploy --only firestore:rules',
            '‚ö†Ô∏è');
        } else {
          updateCheck('firestore', 'error', 
            'Error: ' + error.message,
            '‚ùå');
        }
      }
    }

    async function verificarAuth() {
      try {
        const auth = firebase.auth();
        
        // Verificar que el servicio est√© disponible
        if (auth) {
          const methods = await auth.fetchSignInMethodsForEmail('test@test.com').catch(() => []);
          updateCheck('auth', 'success', 
            'Authentication configurado correctamente',
            '‚úÖ');
        }
      } catch (error) {
        updateCheck('auth', 'error', 
          'Error: ' + error.message,
          '‚ùå');
      }
    }

    async function verificarArchivos() {
      const archivos = [
        'index.html',
        'admin.html',
        'css/style.css',
        'js/app.js',
        'js/firebase-service.js'
      ];

      try {
        // En un entorno real, verificar√≠as con fetch
        // Por ahora asumimos que est√°n presentes
        updateCheck('files', 'success', 
          `Estructura de archivos correcta`,
          '‚úÖ');
      } catch (error) {
        updateCheck('files', 'error', 
          'Algunos archivos pueden estar faltando',
          '‚ö†Ô∏è');
      }
    }

    function mostrarResumen() {
      const summary = document.getElementById('summary');
      const title = document.getElementById('summary-title');
      const text = document.getElementById('summary-text');

      const total = Object.keys(results).length;
      const passed = Object.values(results).filter(r => r).length;

      summary.style.display = 'block';

      if (passed === total) {
        summary.className = 'summary success';
        title.textContent = 'üéâ ¬°Configuraci√≥n Completa!';
        text.textContent = `Todos los checks pasaron (${passed}/${total}). Tu proyecto est√° listo para usar.`;
      } else {
        summary.className = 'summary error';
        title.textContent = '‚ö†Ô∏è Configuraci√≥n Incompleta';
        text.textContent = `${passed}/${total} checks pasaron. Revisa los errores arriba y consulta la gu√≠a de configuraci√≥n.`;
      }
    }

    // Renderizar checks al cargar
    renderChecks();
  </script>
</body>
</html>

